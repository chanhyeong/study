== 4. 테스트 구축하기

* test suite: 불가피하게 저지르는 실수를 잡아주는 견고한 것

=== 자가 테스트 코드의 가치

[quote, ]
모든 테스트를 완전히 자동화하고 그 결과까지 스스로 검사하게 만들자. +
테스트 스위트는 강력한 버그 검출 도구로 버그를 찾는 데 걸리는 시간을 대폭 줄여준다.

* regression bug: 잘 작동하던 기능에서 문제가 생기는 현상
* regression test: 잘 작동하는 기능이 여전히 잘 작동하는지 확인하는 테스트
* JUnit: 스몰토크 버전 단위 테스트 프레임워크를 자바로 포팅한 것

==== 테스트를 작성하기 가장 좋은 시점 - 시작 전

* 작성하다보면 원하는 기능을 추가하기 위해 무엇이 필요한지 고민
* 구현보다 인터페이스에 집중하게 된다
* 테스트를 모두 통과한 시점이 코드를 완성한 시점이다
* TDD (테스트 -> 코딩 -> 리팩토링)

=== 테스트 샘플 코드 (136 ~ 139p)

* Province (지역), Producer (생산자)

=== 첫 번째 테스트

* JS 기준 Mocha
* describe 랑 it 는 java 기준으로 뭐에 대응되는건가?
. fixture 설정 - 테스트에 필요한 데이터와 객체
. 검증
* 정리
** 실패할 상황에는 반드시 실패하게 만들자
** 자주 테스트 - 작성 중인 코드는 몇 분 간격, 적어도 하루에 한 번 전체
* 테스트가 실패할 때는 리팩토링 하자 마라

=== 테스트 추가하기

* 클래스가 하는 일을 보고 각각의 기능에서 오류가 생길 수 있는 조건을 하나씩 테스트
** public 을 전부 테스트하는 것 과는 다름
** 위험요인 중심으로 작성 - 현재 or 향후에 발생하는 버그를 찾는데 있음

[quote, ]
완벽하게 만드느라 테스트를 수행하지 못하느니, 불완전한 테스트라도 작성해 실행하는 게 낫다

* 테스트에서도 중복을 제거하는게 낫다
** beforeEach
* fixture 값은 변경되면 안되고, 매번 새로 만드는게 좋다

=== fixture 수정하기

* 설정 - 수행 - 검증
** setup-exercise-verify, given-when-then, arrange-act-assert
* 구문 하나 당 검증도 하나만

=== 경계 조건 검사하기

* 여태까지는 happy path 에 집중
* 경계 지점에서 문제가 생가는 테스트도 작성하자

[quote, ]
문제가 생길 가능성이 있는 경계 조건을 생각해보고 그 부분을 집중적으로 테스트하자. +
어차피 모든 버그를 잡아낼 수 없다고 생각하여 테스트를 작성하지 않는다면 대다수의 버그를 잡을 수 있는 기회를 날리는 셈이다.

* 이런건 겉보기 동작에 해당하지 않음
** 리팩토링하기 전이라면 저자는 이런 테스트 작성 안함

=== 마무리

* unit test: 코드의 작은 영역만을 대상으로 빠르게 실행되도록 설계된 테스트
* 기존 테스트가 중분희 명확한지, 테스트 과정을 더 이해하기 쉽게 리팩토링할 수 없는지, 제대로 검사하는지 계속 확인
* *버그를 발견하면 바로 버그를 잡아내는 테스트부터 작성하자*