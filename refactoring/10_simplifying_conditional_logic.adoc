== 10. 조건부 로직 간소화

=== 조건문 분해하기 (Decomplose Conditional)

==== 배경

* 다양한 조건, 코드 (읽기 어려움) -> 긴 함수 (읽기 어려움)

==== 절차

. 조건식과 그 조건식에 딸린 조건절 각각을 함수로 추출

=== 조건식 통합하기 (Consolidate Conditional Expression)

==== 배경

* 조건은 다르지만 수행 동작이 같음 -> and, or 로 합침
* 이유
** 하는 일이 명확해짐
** 함수 추출하기로 이어질 수 있음

==== 절차

. 조건식들에 side effect 가 없는지 확인
** 있으면 질의, 변경 함수 분리하기[11.1] 적용
. 조건문 두 개를 선택하여 논리 연산자로 결합
. 테스트
. 2 반복
. 합쳐진 조건을 추출할지 판단

=== 중첩 조건문을 보호 구문으로 바꾸기 (Replace Nested Conditional with Guard Clauses)

==== 배경

* 참, 거짓이 모두 정상 -> if, else
* 한 쪽만 정상 -> 비정상을 if 검사, 참이면 함수에서 빠져나옴 (보호 구문 gaurd clause)

==== 절차

. 교체해야 할 조건 중 가장 바깥 것을 선택하여 보호 구문으로 변경
. 테스트
. 반복
. 모든 보호 구문이 같은 결과를 반환 -> 조건식 통합

=== 조건부 로직을 다형성으로 바꾸기 (Repace Conditional with Polymorphism)

==== 배경

* 복잡한 조건부 로직 = 해석이 난해
* 높은 수준의 개념을 도입해 조건 분리 - 클래스, 다형성

==== 절차

. 다형성 동작을 표현하는 class + factory method
. 호출하는 코드를 factory method 로 대체
. 조건부 로직 함수를 superclass 로 옮김
. subclass 중 하나를 선택
** superclass 의 조건부 로직 메소드를 오버라이드
** 조건부 문장에서 서브클래스에 해당하는 조건절을 복사
, 각 조건절에 대해 반복
. superclass 에는 기본 동작 부분만 남김

==== 의문

* 예시에서 파라미터로 넘어오는 bird 는 뭐로 봐야하는지

=== 특이 케이스 추가하기 (Introduce Special Case)

==== 배경

* 특정 값 확인 -> 똑같은 동작 수행 = 중복 코드
* Special Case Pattern: 특수한 경우의 공통 동작을 요소 하나에 모아서 사용

==== 절차

컨테이너: 리팩토링의 대상이 될 속성을 담은 데이터 구조

. 컨테이너에 특이 케이스인지 체크하는 속성 추가, false 반환 (`isUnknown()`)
. 특이 케이스 객체 생성 - 특이 케이스인지 검사하는 속성만 포함, true 반환 (`UnknownCustomer`)
. 클라이언트 단 특이 케이스인지 검사하는 코드를 함수로 추출 -> 대체 (`isUnknown(arg)`)
. 새로운 특이 케이스 대상 추가. 함수의 반환 값으로 받거나 변환 함수 적용 (그냥 반환하던걸 로직 추가)
** 392p Site 클래스 - 그냥 5번 하지 말고 `return if (isUnknown(this._customer)) ? new UnknownUser() : this.customer` 하면 되는거 아닌가?
. 특이 케이스 검사 로직 -> 특이 케이스 객체 속성을 사용
. 테스트
. 여러 함수를 클래스 or 변환 함수로 묶어서 공통 동작을 새로운 요소로 옮김
. 특이 케이스 검사 로직 -> 검사 함수 인라인

=== 어셔선 추가하기 (Introduce Assertion)

==== 배경

* 특정 조건일 때만 제대로 동작하는 코드 영역
* 보통 코드에 명시적으로 기술되어 있지 않음
** assertion 으로 코드 자체에 삽입해두기
* 프로그램이 어떤 상태임을 다른 개발자에게 알려두는 소통 도구

==== 절차

. 참이라고 가정하는 조건이 보이면 그 조건을 명시하는 어셔선을 추가

==== 코멘터리

* 프로그래머가 일으킬만한 오류에만 어서션 활용
** 외부에서 읽어오면 로직의 일부로 다루어야 한다

=== 제어 플래그를 탈출문으로 바꾸기 (Replace Control Flag with Break)

==== 배경

* 제어 플래그: 코드의 동작을 변경하는 데 사용되는 변수
** 설정 후 다른 어딘가의 조건문에서 검사

==== 절차

. 제어 플래그를 함수로 추출 검토
. 제어 플래그 갱신 코드를 적절한 제어문 (return, break, continue) 로 변경
. 제어 플래그 제거