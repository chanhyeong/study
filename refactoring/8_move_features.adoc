== 8. 기능 이등

=== 함수 옮기기 (Move Function)

==== 배경

* 모듈성 (modularity) - 관련된 작은 부분만 이해해도 수정이 가능하게 해줌
** 연관된 요소 묶기, 연결 관게를 쉽게 찾고 이해할 수 있도록
* 함수가 자신이 속한 모듈보다 다른 모듈의 요소를 더 많이 참조하는 경우
* 함수 내의 함수 중 독립적으로 될 만한 것도 접근하기 쉽게 옮기는게 좋음 (?)

==== 절차

. 함수가 사용하고 있는 모든 요소를 확인하여 같이 옮길지 고민
** 같이 옮길게 있다면 먼저 옮기는게 좋음
** 하위 함수의 호출자가 원 함수 하나면 인라인 시키고 -> 옮기고 -> 다시 추출
*** 이건 그냥 그 함수를 먼저 옮겨버리는게 나을 것 같음
. 다형 메소드인지 확인
. soure function 을 타겟으로 복사. 코드 정리
** 원 파일의 값을 사용하면 매개변수로 넘기거나 자체를 참조로 넘겨줌
** 새로운 이름으로 바꿔줄만한지 확인
. 정적 분석
. 원 파일에서 타겟 함수를 참조할 방법을 찾아 반영
. source function 을 타겟의 delegate 가 되도록 수정
. 테스트
. source function 인라인 검토

=== 필드 옮기기 (Move Field)

==== 배경

* 적합한 데이터 구조로 맞추기 위함
* 레코드를 넘길 때 다른 레코드의 필드도 같이 넘긴다면 -> 데이터 위치를 옮겨야 함

==== 절차

. 캡슐화된 상태가 아니면 캡슐화[6.6]
. 테스트
. 타겟 객체에 필드 생성
. 정적 검사
. 소스 객체에서 타겟 객체 참조 가능 여부 확인
. 접근자들이 타겟 필드를 사용하도록 수정
. 테스트
. 소스 필드 제거
. 테스트

=== 문장을 함수로 옮기기 (Move Statements into Function)

==== 절차

. 반복 코드가 함수 호출 부분과 떨어져 있다면 근처로 옮김 (문장 슬라이드[8.6])
. 타겟 함수를 호출하는게 하나면 코드를 호출되는 함수로 복사하고 테스트 (이 경우는 아래 무시)
. 호출자가 둘 이상이면 호출자 둥 하나에서 '타겟 함수 호출 + 함수로 옮기려는 문장' 을 다른 함수로 추출
. 다른 호출자들이 전부 3에서 만든 함수를 사용하도록 수정. 테스트
. 전부 변경하면 원래 함수를 새로운 함수 안으로 인라인, 원래 함수 제거
. 새 함수의 이름을 원래 함수 이름으로 바꿔줌

=== 문장을 호출한 곳으로 옮기기 (Move Statements to Callers)

==== 배경

* 같이 사용하던 기능이 일부 호출자에게는 다르게 동작하도록 바뀌어야 하는 경우
** 보통 이런건 기존꺼 그대로 두고 옵션 추가하는 식으로 하거나
** 기존 함수를 쪼개서 새로 만들고 기존 함수에서는 새로 만든 함수 호출하게 하고 이런식으로도

==== 절차

. 호출자가 적고 호출되는 함수도 간단하면, 대상 부분을 잘라내서 호출자들로 복사
. 복잡한 상황에서는 이동하지 않길 원하는 모든 함수를 추출하여 새 함수로 만듦
. 원래 함수를 인라인
. 추출된 함수의 이름을 원래 함수의 이름으로 변경

==== 예시

1번 항목은 renderPerson 의 마지막이 아니라 listRecentPhotos 의 마지막이 맞지 않나?

=== 인라인 코드를 함수 호출로 바꾸기 (Replace Inline Code with Function Call)

* 6.1과 비슷하지만 차이는, 6.1 은 함수를 새로 만드는거고, 이거는 기존에 있는 함수로 대체하는거

=== 문장 슬라이드하기 (Slide Statements)

==== 배경

* 관련된 코드들이 가까이 모여있게 하자

==== 절차

. 코드 조각들이 이동할 목표 위치를 찾음. 조각을 모으고 나면 동작이 달라지는게 있는지 확인
** 아래 상황이면 포기한다
*** 코드 조각에서 참조하는 요소를 선언하는 문장 앞으로는 못감
*** 코드 조각을 참조하는 요소의 뒤로는 못감
*** 코드 조각에서 참조하는 요소를 수정하는 문장을 건너뛰어 못감
*** 코드 조각이 수정하는 요소를 참조하는 요소를 건너뛰어 못감
. 코드 조각을 잘라내기 -> 붙여넣기
. 테스트
