== 25. 테스트 주도 개발 패턴

기본적인 테스트 전략에 관한 질문

* 테스트한다는 것은 무엇을 뜻하는가?
* 테스트를 언제 해야하는가?
* 테스트할 로직을 어떻게 고를 것인가?
* 테스트할 데이터를 어떻게 고를 것인가?

=== 테스트 (명사)

* 명사: **자동으로 실행되는 과정**
* 동사: 버튼을 눌러보고 나오는 결과를 주시

positive feedback loop +
스트레스를 받음 -> 테스트를 뜸하게 함 -> (에러가 많아짐) -> 스트레스를 더 많이 받음 -> ...

실패하더라도 테스트를 작성한 후에는 반드시 실행해봐야한다.

=== 격리된 테스트

테스트를 실행하는 것이 서로 아무 영향이 없어야 한다

테스트는 전체보다 좀 더 작은 스케일로 하는 것이 좋다 +
각각의 테스트는 다른 테스트와 완전히 독립적이어야 한다 +
-> 순서에 독립적 
-> 시스템이 응집도는 높고 결합도는 낮은 객체의 모음으로 구성됨

=== 테스트 목록

**시작하기 전에 작성해야 할 테스트 목록을 모두 적어두기** +
(weekly-cycle 이 이거와 비슷한 듯)

리팩토링할 것이 발견되면 지금이 아니라 다음 할일 목록으로 넘기기

=== 테스트 우선

**테스트 대상이 되는 코드를 작성하기 직전에 작성하기**

=== 단언 우선

**assert 를 제일 먼저 쓰고 시작** (self-similarity)

* 시스템을 개발할 때 - 완료된 시스템이 어떨 거라고 알려주는 이야기부터 작성
* 특정 기능을 개발할 때 - 기능이 완료되면 통과할 테스트부터 작성
* 테스트를 개발할 때 - 완료될 때 통과해야 할 단언부터 작성

=== 테스트 데이터

**테스트를 읽을 때 쉽고 따라가기 좋을 만한 데이터 사용** +
데이터 간 차이가 있다면 의미가 있어야 한다

실제 데이터를 사용해야 한다 (아래의 경우에 유용)

* 실제 실행으로 수집한 외부 이벤트 결과 이용 - 실시간 시스템을 테스트
* 예전 시스템의 출력과 현재 시스템의 출력을 비교하고자 하는 경우
* 리팩토링 후 기존과 정확히 동일한 결과가 나오는지 확인하고자 할 경우

=== 명백한 데이터

테스트 자체에 예상되는 값 (expected) 과 실제 값 (actual) 을 포함, 이 둘 사이의 관계를 드러내기 위해 노력

매직넘버를 사용하지 않아야 한다는 것에 대한 예외

== 26. 빨간 막대 패턴

테스트를 언제 어디에 작성할 것인지, 테스트 작성을 언제 멈출 것인지

=== 한 단계 테스트

**새로운 무언가를 가르쳐 줄 수 있고, 구현할 수 있다는 확신이 드는 테스트를 먼저 선택하기**

아는 것 -> 모르는 것 순서로

=== 시작 테스트

**오퍼레이션이 아무 일도 하지 않는 경우를 먼저 테스트하기**

=== 설명 테스트

**테스트를 통해 설명을 요청, 테스트를 통해 설명** (더 널리 쓰이게 하기 위해)

=== 학습 테스트

(외부에서 만든 소프트웨어에 대한) **패키지의 새로운 기능을 처음으로 사용해보기 전에 작성**

=== 또 다른 테스트

주제에서 벗어나지 않고 기술적인 논의 지속하기 위해 +
**주제와 무관한 아이디어가 떠오르면 할일 목록에 적어놓고 주제로 돌아오기**

=== 회귀 테스트

시스템 장애 발견 시, **장애로 인해 실패하는 & 통과할 경우에 장애가 수정되었다고 볼 수 있는 테스트를 작성**

(정산에서 실패한 input 에 대한 테스트를 만들고, 통과시켰다)

=== 휴식

**어려울 때는 쉬어라**

* 뭘 할지 알면? -> 구현
* 모르면? -> 가짜 구현
* 설계가 명확하지 않으면? -> 삼각측량
* 그래도 모르면? -> 샤워나 하러 가라

positive feedback loop +
피로 -> 판단력 흐림 -> 피로 -> ...

==== 휴식 루프

* 시간: 물병 - 생리 현상
* 하루: 잠이 필요한 경우 업무 이후 약속 취소
* 주: 업무 관련 생각을 버리기 - 주말을 편하게
* 년: 강제 휴가 (3 ~ 4주)

진전이 없다면 휴식을 취하지 않았기 때문일 것 - 산책해라

=== 다시 하기

길을 잃었을 때? **코드를 다 지우고 처음부터 시작하기**

=== 싸구려 책상, 좋은 의자

다른건 모르고 **좋은 의자를 구해라**

허리가 아프면 안된다

== 27. 테스팅 패턴

=== 자식 테스트

지나치게 큰 테스트? -> **원래 테스트 케이스의 깨지는 부분에 해당되는 작은 테스트 작성 - 작은 테스트 실행 -> 원래 큰 테스트 추가**

=== 모의 객체 (Mock Object)

비용이 크거나 복잡한 리소스에 의존하는 객체 테스트 - **상수를 반환하게 만든 속임수 버전의 리소스 만들기**

(사실 단위테스트 책에서는 되도록 mock 쓰지 말라고 하긴 함)

=== 셀프 션트 (self shunt)

객체가 다른 객체와 올바르게 대화하는지 테스트 +
**테스트 대상이 되는 객체가 원래 대화 상대가 아니라 테스트 케이스와 대화하도록 하기**

테스트 케이스가 구현할 인터페이스를 얻기 위해 인터페이스 추출을 해야 한다 +
추출이 쉬운지, 블랙 박스로 테스트가 쉬운지는 결정해야 한다

=== 로그 문자열

**호출 순서를 검사하려면 로그 문자열을 가지고 있다가 메시지가 호출될 때마다 문자열에 추가되도록 하기**

=== 크래시 테스트 더미

에러 코드 테스트 - **실제 작업 수행대신 그냥 예욀르 발생시키는 특수한 객체를 만들어 호출**

=== 깨진 테스트

**프로그래밍 세션은 마지막 테스트가 깨진 상태로 끝마치는 것이 좋다**

다음에 다시 앉았을 때, 어느 작업부터 시작할 지 명백히 알 수 있다

(나는 이럴 때도 있고, 메모장에 내일은 뭐할지 적어두는 방법을 사용하긴 한다)

=== 깨끗한 체크인

**팀 프로그래밍을 할 때는 모든 테스트가 성공한 상태로 끝마치는 것이 좋다**