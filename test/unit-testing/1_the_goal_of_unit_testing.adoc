= 1. 단위 테스트의 목표

[quote]
테스트에 드는 노력을 가능한 줄이고 이득을 최대화를 달성한 프로젝트 +
= 무난하게 성장하고 유지 보수가 많지 않으며 변화하는 요구에 신속이 대응할 수 있는 프로젝트

좋은 단위 테스트를 작성하는 것은 어떤 의미인가?

== 목표

소프트웨어 프로젝트의 *"지속 가능한 성장"* 을 가능하게 하는 것

software entropy: 개발 속도가 빠르게 감소하는 현상 (entropy: 시스템 내 무질서도) +
-> 품질을 떨어뜨리는 코드 형태 - 코드를 무언가를 변경할 때마다 entropy 증가 +
지속적인 정리, 리팩토링 등으로 관리하지 않으면 시스템이 더 복잡해지고 무질서해진다

테스트: 안전망 역할, 대부분의 회귀 (regression) 에 대한 보험 +
새로운 기능, 요구 사항에 더 잘 맞게 리팩토링 한 후에도 기존 기능이 잘 작동하는지 확인하는데 도움

초반에 노력이 필요하다는 단점, 후반에도 잘 성장할 수 있도록 하므로 장기적으로는 비용을 메울 수 있음

지속성과 확장성이 핵심. 장기적인 개발 속도 유지

=== 좋은 테스트, 좋지 않은 테스트를 가르는 요인

테스트의 가치와 유지 비용을 모두 고려해야 한다. 아래는 비용 요소

* 기반 코드를 리팩토링할 때 테스트도 리팩토링
* 각 코드 변경 시 테스트 실행
* 테스트가 잘못된 경고를 발생시킬 경우 처리
* 기반 코드가 어떻게 동작하는지 이해하려면? -> 테스트를 읽는 데 시간을 투자

.production code vs test code
****

코드는 자산이 아니라 책임이다 +
코드가 많아질수록 버그에 더 노출되기 싶고, 유지비가 증가한다 (테스트도 많은게 좋은게 아니다)

테스트도 코드이므로 애플리케이션의 정확성을 보장하는 것을 목표로 하는 코드베이스의 일부로 봐야 한다 +
= production 코드처럼 버그에 취약하고 유지 보수가 필요하다

****

== 테스트 스위트 품질 측정을 위한 커버리지 지표

커버리지 지표 = 테스트 스위트가 소스 코드를 얼마나 실행하는지 백분율 +
높다고 테스트 스위트가 좋은 품질인 것은 보장할 수 없다 = 괜찮은 부정 지표, 좋지 않은 긍정 지표

=== code coverage

code coverage (test coverage) = 실행 코드 라인 수 / 전체 라인 수

코드가 작을수록 지표가 좋아지는 함정 +
= 삼항연산자 (ternary operator) 의 경우 실제 조건이 확인이 안되더라도 커버리지에 들어가버림

=== branch coverage

if, switch 문과 같은 제어 구조에 중점을 둔다

branch coverage = 통과 분기 / 전체 분기 수

코드베이스에서 모든 가능한 분기를 합산 + 그 중 테스트가 얼마나 많이 실행되는지 확인

=== 커버리지 지표에 관한 문제점

커버리지 지표로 품질 결정을 의존할 수 없는 이유

* 테스트 대상 시스템의 모든 가능한 결과를 검증한다고 보장할 수 없음
* 외부 라이브러리의 코드 경로를 고려할 수 있는 커버리지 지표가 없음

=== 특정 커버리지 숫자를 목표로 하기

커버리지 지표는 지표 그 자체로 보고, 목표로 여겨서는 안된다

커버리지 숫자를 목표로 하면 그릇된 동기 부여가 된다 +
중요한 것을 테스트하지 않고, 인공적인 목표를 달성하기 위한 방법을 찾기 시작

== 무엇이 성공적인 테스트 스위트를 만드는가?

스위트 내 각 테스트를 하나씩 따로 평가

성공적인 테스트 스위트의 특성들

* 개발 주기에 통합
* 코드베이스에서 가장 중요한 부분만을 대상
* 최소한의 유지비로 최대의 가치를 끌어냄

=== 개발 주기에 통합

자동화된 테스트를 하는 방법은 끊임없이 하는 것 +
모든 테스트가 개발 주기에 통합 +
코드가 변경될 때마다 아무리 작아도 실행

=== 코드베이스에서 가장 중요한 부분만을 대상

시스템의 가장 중요한 부분 (비즈니스 로직) 에 노력, 다른 부분은 간략하게 또는 간접적으로 검증

다른 부분 (이 중 복잡한하고 중요한 알고리즘이 있는 일부는 철저히 해야 할 수 있다)

* 인프라 코드
* DB, Third party 등 외부 서비스 및 종속성
* 모든 것을 하나로 묶는 코드

이걸 따르려면 도메인 모델을 코드베이스 중 중요하지 않은 부분과 분리해야 한다 +
(단위 테스트에 대한 노력을 도메인 모델에 집중)

=== 최소 유지비로 최대 가치를 끌어냄

* 가치 있는 (& 가치가 낮은) 테스트 식별하기
* 가치 있는 테스트 작성하기

기준틀 (frame of reference) 이 필요 & 설계 기술도 알아야 한다

== 이 책을 통해 배우는 것

. 테스트 스위트 내의 모든 테스트를 분석하는 데 사용할 수 있는 기준틀을 설명
** 새로운 관점에서 많은 테스트를 볼 수 있
** 어떤 것이 프로젝트에 기여, 어떤 것을 리팩토링해야 하는지, 제거해야 하는지 알 수 있음
. 기초 (4장) -> 기존 단위 테스트 기술과 실천을 봄 (4 ~ 6장, 7장 일부)

기준틀 외의 내용

* production 코드와 관련 테스트 스위트를 리팩토링하는 방법
* 단위 테스트를 다양한 스타일로 적용하는 방법
* 통합 테스트로 시스템 전체 동작 검증하기
* 단위 테스트 안티 패턴을 식별하고 예방하기