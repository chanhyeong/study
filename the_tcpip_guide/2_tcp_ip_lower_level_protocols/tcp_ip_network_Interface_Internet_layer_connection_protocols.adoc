= TCP/IP 네트워크 인터페이스 / 인터넷 계층 연결 프로토콜

== 13장. 주소 결정과 TCP/IP 주소 결정 프로토콜 (ARP)

=== 주소 결정 개념과 이슈

==== 2계층과 3계층에서의 주소지정

* 2,3 은 주소지정을 다루는 계층
** 두 계층에서 사용하는 주소는 서로 다른 목적에 쓰이고, 유형도 다르다
** 2계층: 하드웨어 장비 간 로컬 전송 (직접)
** 3계층: 대량 가상 네트워크를 구축 (간접)
* 3계층 연결은 가상, 개념적이고 실제 전송은 물리 계층과 데이터 계층에서 일어난다
** 목적지와 가장 가까운 곳에 있는 라우터 -> 목적지의 데이터 링크 (MAC) 주소로 요청을 보낸다
* IP 주소가 하드웨어보다 너무 높은 수준에 있는게 문제
** **주소 결정: 두 계층의 주소를 변환하는 방법**

==== 직접 매핑

* 특정 공식을 이용해 상위 계층 주소를 하위 계층 주소로 매핑
* 계층 하나만 알아도 다른 계층의 주소를 바로 알 수 있다
* 문제점
** 3계층 주소가 2계층 주소보다 작을 때는 직접 매핑을 할 수 없다
** 낮은 유연성

==== 동적 주소 결정

IP 주소를 알면 해당 데이터 링크 계층 주소를 찾아낼 수 있는 특수한 프로토콜 이용

. 요청 장비: 목적지 장비의 3계층 주소를 담은 2계층 프레임 브로드캐스트
. 목적지 장비: 브로드캐스트 프레임을 인식하고 요청 장비로 직접 응답
. 요청 장비: 목적지 장비의 2계층 주소를 알게되고 주소 결정 완료
* 효율성 문제 - 캐싱
** 기타: 목적지가 응답을 보낼 때 목적지도 요청 장비의 주소를 캐싱

=== TCP/IP 주소 결정 프로토콜 Address Resolution Protocol (ARP)

* IP 주소에 해당하는 데이터 링크 계층 주소를 파악하는 데 쓰이는 동적 결정 프로토콜
** 이더넷 뿐만 아닌 다양한 데이터 링크 계층 기술에서 사용되는 주소로 변환할 수 있는 범용 프로토콜
* IP 주소를 브로드캐스트 -> ... (위와 동일), 캐싱

동작 방식 - p215 그림 참고

==== 메시지 포맷

* 유형, 2계층 주소, 3계층 주소, 프로토콜 유형, 주소 및 길이 정도
** IPv4, 802 MAC -> 28바이트

==== 캐싱

* 정적/동적 항목
* 10 ~ 20분의 만료 시간 지정

==== 프록시 ARP

* 3계층에 라우터가 끼어 있는 경우, 응답으로 목적지 주소를 주지 않고 라우터 하드웨어 주소로 대신 응답
** 네트워크 계층에서는 동일 네트워크에 있는 것처럼 설정된 네트워크에 적합
* 단점
** 프록싱으로 인한 복잡함
** 동일한 네트워크 ID 를 연결하는 두 물리 네트워크를 연결하는 경우 문제 발생
** 잠재적인 보안 위험 - 속일 수 있는 환경

=== IP 멀티캐스트 주소의 TCP/IP 주소 결정

* ARP 는 유니캐스트 결정을 위한 프로토콜
* 멀티캐스팅: 데이터그램이 여러 수신자에게 전송
** ARP 방식이면 장비 주소들 간에 관계를 맺어야 한다
* IEEE 802 - 멀티캐스트가 가능한 가장 널리 쓰이는 데이터 링크 주소지정 방법
** 상위 24비트: 기관 유일 식별자 (OUI) - IANA 것으로 채움
** 하위 24비트: 개별 장비 구분
*** 첫 비트 = 0
*** 나머지 23비트 = 멀티캐스트 IP 주소
** IP 멀티캐스트는 28비트여서 23비트로 변환되면서 유일한 매핑이 되지 않음
*** 한 네트워크에서 두 IP 멀티캐스트 주소가 동일한 이더넷 멀티캐스트 주소로 매핑될 확률은 작다
*** 수신 측에서는 IP 계층으로 올려보내 전체 IP 캐스트 주소 확인

=== IPv6 의 TCP/IP 주소 결정

* ND (Neighbor Discovery) protocol
* 동적, 캐싱
* ND 주변 정보 요청 메시지 생성
** 데이터 링크가 멀티캐스팅을 지원하면 IPv6 주소를 결정하고자 하는 대상 장비의 요청 노드 주소로 전송
*** ??? 대상 장비를 어떻게 특정?
* 요청 노드 멀티캐스트 주소: 유니캐스트 주소로부터 특수한 매핑을 통해 만드는 주소 (25장)
** 요청 노드 주소는 같은 값을 가질 확률이 적다
** 멀티캐스트는 작은 수의 장비에만 영향

== 14장. 역순 주소 결정과 TCP/IP 역순 주소 결정 프로토콜 (RARP)

* Reverse Address Resolution Protocol (RARP)
** 일반적인 동작은 ARP 와 동일
* 장비 A가 처음 bootstraping (구동 시점) 할 때 자신의 IP 를 모르는 경우
** RARP 서버에 자신의 하드웨어 주소를 보내서 응답을 받음

=== 제약

* 하위 수준 하드웨어 기반: 하드웨어 브로캐스트를 통해 동작
** 모든 네트워크 세그먼트에서 RARP 서버 운영 필요
* 수동 할당: RARP 서버의 하드웨어와 IP 주소 매핑 테이블은 수동으로 설정되어야 함
* 제한된 정보: 오직 IP 주소만을 알려줌

RARP 는 가장 초창기에 나온 기초적인 기술 +
좀 더 강력한 기능의 프로토콜인 **BOOTP 와 DHCP** 가 쓰인다