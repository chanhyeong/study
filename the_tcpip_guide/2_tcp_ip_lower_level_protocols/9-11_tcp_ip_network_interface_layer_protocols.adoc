= TCP/IP 네트워크 인터페이스 계층 프로토콜

== 9장. TCP/IP 직렬 회선 인터넷 프로토콜과 점대점 프로토콜의 개요 와 기초

=== SLIP 과 PPP 비교

3계층의 IP 와 1계층의 물리 연결 사이의 간격을 채우기 위한 프로토콜

* SLIP: 기본 프레이밍만 제공
* PPP: 프레이밍뿐만 아니라 보안과 성능을 강화하기 위한 여러 추가 기능 제공

PPP 가 많이 사용되고 SLIP 은 잘 쓰이지 않는다 +
둘 다 두 장비 간의 연결에 쓰이도록 설계됐다

=== Serial Line Internet Protocol (SLIP)

* 직렬 회선으로 전송할 IP 메시지를 프레이밍하기 위한 매우 간단한 프로토콜
** 간단해서 표준화할 것이 별로 없었음

==== 데이터 프레이밍 방법과 일반 동작

* 바이트로 나누어 한 번에 하나씩 링크를 통해 전송
* 최종 바이트가 전송되면 SLIP END 문자를 보낸다
* 개선
** 데이터그램 앞 부분에도 END 문자를 삽입하여 수신자 측 혼란 개선
** 데이터그램 내 END 문자가 있는 경우 escape 문자 추가 처리

==== 문제와 한계

아래 내용들이 보장이 안됨

* 표준화된 데이터그램: 최대 크기가 표준화되지 않음, 구현마다 다름
* 에러 탐지와 정정 방법: 어떤 방법도 없음. 3계층에 넘어가서야 가능한데 직렬 링크는 느려서 특히나 비효율적
* 제어 메시지 전송
* 유형 식별: SLIP 이 쓰이는지 아닌지 식별 불가
* 주소 탐색 방법, 압축 지원, 보안 기능

=== Point-to-Point Protocol (PPP)

* 연결형 프로토콜, 서로 다른 여러 물리 계층 위에서 2계층 링크를 가능하게 한다
* 장점은 SLIP 의 약점과 유사
** END 보다 포괄적인 프레이밍
** 3계층 프로토콜을 다중화 할 수 있는 캡슐화 프로토콜 명세 제공
** CRC 코드 삽입으로 에러 탐지
** 링크 인자 협상 - 안정적
** 전송이 일어나기 전에 링크 테스트, 링크 품질 모니터링 방법 제공
** 인증, 압축, 암호화, 링크 통합

==== 주요 구성 요소

. PPP 캡슐화 방법
** 특수 프레임 포멧 정의, 크기가 작음. 대역폭 효율과 처리 속도 극대화를 위해 적은 수의 필드만 포함
. 링크 제어 프로토콜 (LCP, Link Control Protocol): 장비 간 링크 수립, 유지, 종료 수행
** 두 장비가 링크 사용 방법을 협의하기 위해 여러 설정 인자 교환
. 네트워크 제어 프로토콜 (NCP, Network Control Protocol): 서로 다른 여러 3계층 데이터그램 유형을 캡슐화 하는 기능 지원
** IP: IPCP, Internet Protocol Control Protocol

==== PPP 기능 그룹

기본 동작을 지원하거나 향상시키기 위해 추가된 프로토콜

* LCP 지원 프로토콜: 링크 협상 과정에서 관리나 옵션 설정 (10장)
* LCP 선택적 기능 프로토콜: 데이터그램이 장비 간에 전송될 때의 동작을 향상

==== 일반 동작

. 링크 수립과 구성: 링크의 운영을 관리하는 데 필요한 인자에 동의
** LCP 가 시작. 수립되면 적절한 NCP 호출
. 링크 동작: 데이터그램 전송
** 수신 측: 물리 계층에서 올라온 PPP 프레임을 받아 PPP 헤더를 제거하고 데이터그램을 3계층으로 올려보냄
. 링크 종료

==== 링크 수립과 단계

* 설립 과정: 링크를 설정하고 데이터를 어떻게 전송하는지를 지정하는 인자에 서로 동의
* LCP: 링크 수립 및 유지 역할. LCP 링크 개방 후 3계층 프로토콜을 위한 하나 이상의 NCP 호출
* 단계
.. 링크 비활성화: 물리 계층 연결이 존재하지 않는 상황
.. 링크 수립: 물리 계층은 연결됐고 LCP 가 링크 기본 설정 수행
*** 동의 후 링크 개방 상태로 바뀌고 인증으로 넘어감
.. 인증 (선택)
.. 네트워크 계층 프로토콜: 적절한 NCP 호출
*** NCP 는 더 이상 필요하지 않을 경우 독립적으로 닫힐 수 있음
.. 링크 개방
.. 링크 종료: 특수 LCP 종료 프레임 전송
*** NCP 링크를 닫는다고 해서 LCP 링크도 닫을 수 있는 것은 아님
*** PPP 연결을 종료하려면 링크 종료 단계에서 LCP 링크를 끝내야 함

== 10장. PPP 핵심 포로토콜: 링크 제어, 네트워크 제어, 인증

=== 링크 제어 프로토콜 (LCP)

물리 링크로 LCP 메시지 (LCP 패킷 or LCP 프레임) 전송, 전체 11개

단계(전체 개수): 대표

* 링크 설정(4개): 설정 요청 (Configure-Request), 설정 승인 (Configure-Ack) 메시지
** 설정 요청, 설정 승인
** 설정 비승인: 모든 옵션이 협상 가능, 옵션 값을 받을 수 없음
** 설정 거부: 어떤 옵션도 인식할 수 없거나, 받아들일 수 없고 협상할 여지도 없음
* 링크 개방(5개): 에코 요청 (Echo-Request), 에코 응답 (Echo-Reply)
** 코드 거부, 프로토콜 거부, 에코 요청, 에코 응답, 버림 요청
* 종료(2개): 종료 요청 (Terminate-Request), 종료 승인 (Terminate-Ack)

=== 네트워크 제어 프로토콜 (NCP)

* LCP 에서 기본적인 링크 수립 -> 인증 -> 3계층 프로토콜에 해당하는 NCP 호출
* 특정 네트워크 계층 프로토콜에 유일한 인자를 협상
* LCP 링크별로 하나 이상의 NCP 운영 가능
* 기본 동작은 LCP 와 유사, 전체 7가지 유형

=== PPP 인증 프로토콜: PAP 와 CHAP

* PAP (Password Authentication Protocol)
** 인증 요청, 인증 응답
** 이름, 비밀번호를 평문 형태로 전송 == 도청 가능, 보안 공격 방어책 없음
* CHAP (Challenge Handshake Authentication Protocol)
** 3-way handshake 로 인증 수행
*** Challenge: Challenge 프레임 (간단한 텍스트) 을 만들어 초기화 장비에 전송
*** Response: 초기화 장비가 비밀번호를 이요하여 텍스트 암호화 -> 인증자에 응답으로 전송
*** Success or Failure: 인증자가 동일한 방법으로 텍스트 암호화, 동일하면 성공 메시지 전송
** 두 장비가 동일한 공유 비밀 정보를 가지고 있다는 것을 증명 & 비밀 정보를 링크로 전송하지 않아도 됨
** 재생 공격 방어: 각 메시지의 식별자와 챌린지 텍스트 변경
** 서버가 인증 절차 제어

== 11장. PPP 기능 프로토콜

=== PPP 링크 품질 모니터링과 리포팅 (LQM/LQR)

* PPP 기본 패키지에서 송신 프레임의 에러를 탐지하기 위한 방법 제공
** 링크의 현재 상태에 대한 유용한 정보를 제공하진 않음
* Link Quality Monitoring (LQM): 장비들이 링크의 품질을 분석할 수 있도록 하는 기능
* Link Quality Reporting (LQR): 모니터링 기능, 현재 링크의 통계 정보를 수집하여 주기적으로 전송 요청

==== LQR 수립

* 장비를 여는 링크가 설정요청 프레임에 품질 프로토콜 설정을 포함시켜 링크 모니터링 요청
** reporting period 도 지정
* 타이머마다 링크 품질 보고서 생성, 0xC025 로 채워진 PPP 프레임으로 전송
* 절대값

==== 링크 품질 보고서 사용

* 구체적인 표준은 없고, 숫자에 근거하여 장비마다 결론 및 행동 결정 가능

[NOTE]
 상위 계층 프로토콜 통계를 수집하지만, 계층 프로토콜별 통계는 수집하지 않음 +
 -> 링크의 품질이 상위 계층 프로토콜에 따라 달라지는 것은 아니기 때문

=== PPP 압축 제어 프로토콜 (CCP) 과 압축 알고리즘

PPP 는 직렬 연결 -> 느리기 때문에 성능 향상을 위해 압축 사용 +
물리 계층에서는 데이터 스트림을 압축하는 기능 제공

PPP 에서도 선택적인 압축 기능 제공

* Compression Control Protocol (CCP): 압축을 협상하고 관리
* 압축 알고리즘: 실제 데이터 압축/해제 알고리즘 모음

==== CCP 운영: 압축 기능 수립

* 압축 기능을 설정하고 제어하는 데만 쓰임
* CCP 도 NCP 처럼 LCP 의 경량 버전

==== CCP 설정 옵션과 압축 알고리즘

* 두 장비가 사용할 압축 알고리즘 협상, 어떻게 사용할 것인지에 대한 정보를 얻는 데 쓰임
.. 시작 장비: 자신이 지원하는 압축 알고리즘 정보별로 하나씩 옵션을 설정한 설정요청 메시지 전송
.. 상대방 장비: 옵션 목록을 자신이 이해하는 알고리즘과 비교, 각 알고리즘 사용법과 관련된 옵션의 세부 사항 검사하여 적절한 응답 전송
.. 공통 알고리즘에 동의할 때까지 계속 -> 동의하면 압축 기능 활성화

==== 압축 알고리즘 운영: 데이터 압축과 해제

* 프레임이 압축됐다는 것을 나타내기 위한 0x00FD 를 넣음
** 다중 링크에서 압축 시에는 0x00FB
* 압축되지 않은 일반 프레임에서 프로토콜 필드는 어떤 3계층 프로토콜에서 데이터가 오는지를 나타내는 데 쓰임, 원본 프로토콜 필드를 데이터 앞에 첨부
** 해제 시 이 값을 이용하여 프로토콜 필드 복구, 수신 장비에서 알 수 있음
** ex) IPCP 를 이용하여 PPP 에 IP 캡슐화
... 압축되지 않은 프레임의 프로토콜 필드 값: 0x8021, 압축할 데이터의 첫 부분에 위치
... 압축된 데이터는 0x00FD 를 갖는 PPP 프레임에 채워짐
... 수신자: 0x00FD 를 보고 압축 인지 -> 해제, 0ㅌ8021 qhrdnjs
* 압축과 암호화를 동시에 할 수 있음. 압축 -> 암호화 순서

=== PPP 암호화 제어 프로토콜 (ECP) 과 암호화 알고리즘

CCP 와 동일하여 생략

=== PPP 다중링크 프로토콜 (MP/MLP/MLPPP)

* 일반적으로 두 장비 간에는 하나의 물리 계층 링크만 존재, 일부 장비에서는 두 개의 1계층 연결이 존재
** 두 장비 간의 연결 통로를 늘려서 성능 향상을 꾀함
** 하드웨어 링크는 하나지만 논리적 채널이 여럿 있을 수도 있음
* 링크가 여러 개 이쓴 경우, 링크별 독립적인 PPP 연결을 수립할 수 있지만, 이상적이지는 않음
** 각 링크별로 트래픽을 분배하는 작업을 수동으로 해야함
* **여러 링크를 결합하여 하나의 고성능 링크인 것처럼 사용**

==== 구조

* 선택적 기능, PPP 의 새로운 하위 계층으로 구현
* MP 하위 계층은 일반 PPP 계층 ~ 네트워크 계층 프로토콜 사이에 위치
* MP 를 사용할 경우 두 개 이상의 물리 링크 가각에서 동작하는 PPP 구현들이 존재

==== 수립과 설정

* 양 장비의 PPP 소프트웨어에 MP 가 구현이 되어 있어야 하고, MP 사용을 협상해야 한다 (3가지 옵션)
** 다중링크 최대 수신 재구성 유닛 (Multilink Maximum Received Reconstructed Unit)
** 다중링크 짧은 순서번호 헤더포맷 (Multilink Short Sequence Number Header Format)
** 종단 식별자 (Endpoint Discriminator)

==== 운영

네트워크 계층과 일반 PPP 링크 사이의 중간자 역할

* 송신: 네트워크 계층에서 데이터그램을 받아 캡슐화, 여러 물리 링크로 어떻게 보낼지 결정
* 수신: 모든 물리 링크에서 받은 프레임 조각 재조합, 원본 PPP 프레임 구성
* 재조합을 위해 각 프레임에 순서 번호 부여, 식별하기 위한 제어 정보도 필요

=== PPP 대역폭 할당 프로토콜과 대역복 할당 제어 프로토콜 (BAP/BACP)

* 링크 묶음이 항상 활성화되어야 하기 때문에, 링크를 유지하는 비용이 많이 든다
* 전체 링크 묶음에 추가/제거하는 설정
* Bandwidth Allocation Protocol (BAP): MP 로 동작하는 장비들이 특정 링크를 묶음에 추가/제거할 수 있도록 하는 방법
* Bandwidth Allocation Control Protocol: BAP 사용 방법을 설정

==== BACP 운영: BAP 사용 설정

* 링크 설정 과정 중에 BAP 를 수립하는 데 사용
* Favored-Peer 설정 옵션: 두 장비가 동시에 동일한 요청을 보낼 때 문제가 일어나지 않는 것을 보장
** 두 장비가 BAP 를 지원한다면 협상 성공, 활성화

==== BAP 운영: 링크 추가와 제거

* 현재 PPP 링크 묶음에서 링크를 제거하거나 추가하기 위해 보낼 수 있은 메시지 모음을 정의
* 콜요청, 콜응답: 링크 추가, 초기화 (상대방 장비에게 요청)
* 콜백요청, 콜백응답 (상대방 장비가 요청)
* 링크제거요청, 링크제거응답