= 인터넷 프로토콜 버전 4 (IP/IPv4)

== 15장. 인터넷 프로토콜 버전, 개념, 개요

* 네트워크 계층은 서로 다른 네트워크에서 임의의 방법으로 연결된 장비 사이에서 데이터를 전달
** 서로 연결되지 않은 네트워크 장비 간 데이터를 전달
* IP 는 데이터를 TCP/IP 네트워크에서 전송하는 방법

=== 주요 동작 특성

* 전역 주소지정: 네트워크를 위한 주소지정 방법 정의, 데이터그램 전달에 사용
* 하위 프로토콜에 무관: 어떤 종류의 하위 네트워크에서도 데이터를 전송하도록 설계
* 비연결형 전달: 연결과 상관 없이 데이터그램을 만들어서 곧바로 전달
* 신뢰성 없는 전달: 데이터그램을 보낸 뒤 바로 송신. 전달을 보장하진 않음
* 비승인형 전달: 송신한 데이터그램이 제대로 전송됐는지 알지 못함

보장형 기능은 성능에 영향, 계층 구조에 맡김 +
TCP 와 UDP 의 차이로 이해할 수 있다

=== 기능

. 주소지정: 호스트 주소지정 방법을 포함
** 임의의 대형 네트워크에서 유일하게 장비의 주소를 지정할 수 있도록 설계
** 원거리 네트워크로 라우팅을 가능케하는 구조
. 데이터 캡슐화와 포매팅/패키징
. 단편화와 재조합: 데이터그램을 조각으로 단편화하여 로컬 네트워크로 보내는 기능
. 라우팅과 간접 전달
** 직접 연결되지 않은 원거리 네트워크로의 라우팅
** ICMP, RIP (Routing Information Protocol), BGP (Border Gateway Protocol)

=== 역사, 표준, 버전, 밀접히 연관된 프로토콜

* IP 자체는 TCP/IP 프로토콜 슈트가 정의된 처음 몇 년은 존재하지 않음
** TCP 에 속해서 3가지 버전으로 개선되었다가, 버전 4에서 분리
* 버전 5는 왜 없는가? -> 실험적 프로토콜에 할당되었다가 6이 새로 개발됨

==== 관련 프로토콜

IP 의 일부는 아니지만, 특수한 상황을 위해 IP 의 기능을 추가하거나 확장하는데 쓰임

* NAT (Network Address Translation) - 28장
* IPsec (IP Security) - 29장
* Mobile IP - 30장

== 16장. IPv4 주소지정 개념과 이슈

=== 개요와 기초

2가지 기능

* 네트워크 인터페이스 식별: 올바른 수신자에게 전달 보장을 위해 장비와 네트워크 간의 인터페이스를 유일하게 식별할 수 있도록 함
* 라우팅: 동일 네트워크에 있지 않은 경우 간접적으로 전달

IP 주소가 장비 자체가 아니라 네트워크 인터페이스를 식별 +
-> 대형, 가상 네트워크 연결에 초점이 맞춰져 있다

라우터가 주소 내용을 통해 데이터그램의 처리 방향을 결정할 수 있도록 주소지정 체계가 설계되어 있다

==== 장비별 IP 주소의 수, 유일성과 한정성

* 모든 장비에는 IP 주소가 하나씩 있다
* 라우터는 하나 이상의 IP 주소를 가질 수 있다
** 2계층 장비 (리피터, 브리지, 스위치) 는 IP 주소가 없어도 된다 (optional)
* 단일 인터네트워크 상에서 각 IP 는 유일해야 한다
* 장비가 새로운 네트워크로 이동한다면 IP 주소도 함께 바뀌어야 한다

==== Private/Public IP 네트워크 주소

* Private 네트워크에서는 각 기관이 모든 장비의 주소 할당 제어
* Public 네트워크에서는 유일성 보장을 위한 방법 필요 - 공인 IP 등록/관리 기관
** 사설 주소가 사용하는 네트워크가 공중 TCP/IP 네트워크에 접속할 수 있는 NAT 도 있다

==== IP 주소 설정과 주소지정 유형

* 정적: 고정 IP
* 동적: 소프트웨어가 IP 주소 할당과 변경 제어 (BOOTP, DHCP)
* 주소지정 방법은 uni/multi/broadcast 를 모두 지원한다

=== IP 주소 크기, 주소 공간, 표기법

* 32비트 이진수 -> 8비트 옥텟으로 나누어 보통 10진수로 표현
* IP 주소의 구조와 할당 방법 때문에 32승 전부를 사용할 수는 없다
** IP 가 비교적 작은 인터네트워크용으로 개발되어서 낭비가 심하다 (ex. 127 은 loopback 주소로 예약되어 있다)
* Public 네트워크에서는 모든 장비가 사용 가능한 주소 공간을 공유해야 한다
** CIDR (Classless Inter-Domain Networking), Supernetting, NAT 와 같은 것들은 효율적으로 사용하기 위해 설계됐다

=== IP 기본 주소 구조와 주요 구성 요소

==== 네트워크 ID 와 호스트 ID

* 네트워크 ID: 특정 수의 prefix 비트는 호스트나 기타 네트워크 인터페이스가 위치한 네트워크를 식별하는 데 쓰임
** 라우터가 IP 데이터그램을 라우팅하는 데 쓰임 - 목적지 IP 주소가 출발지 IP 주소와 동일 네트워크에 있는가?
* 호스트 ID: 네트워크의 호스트를 식별하는 데 쓰임

==== 네트워크 ID 와 호스트 ID 구분 위치

* 지점이 고정되어 있지 않음 -> 바로 뒤에 주소지정 범주에서 확인
* 자체적으로 특수한 의미를 갖기도 한다
** ex. 호스트 ID 부분이 모두 1로 설정된 네트워크 ID: 그 네트워크로의 브로드캐스트 주소
** ex. 네트워크 ID 부분이 모두 0으로 설정된 호스트 ID: 로컬 네트워크에서의 그 호스트 ID 를 지정하는 IP 주소

=== IP 주소지정 범주와 IP 주소 부속물

==== 전통적 (클래스 단위) 주소지정

* 옥텟 단위로 구분, classless 와 구분하기 위해 classful 주소지정 방법
* 구분 지점을 각 주소의 처음 몇 비트에 인코딩. 라우터는 이 비트로 파악

==== 서브넷을 이용하는 클래스 단위 주소 지정

* 네트워크, 호스트가 아닌 3단계로 분리
** 호스트 ID 의 일부 비트를 서브넷 식별자로 이용 (네트워크 ID 는 변하지 않음)
* ex. 네트워크 ID 24비트, 호스트 ID 8비트인 경우
** 호스트 ID 8비트 = 서브넷 ID 3비트 + 호스트 ID 5비트
** 서브넷 마스크 (subnet mask): 서브넷 ID 와 서브호스트 ID 를 구분하는 점 
*** 여기서는 27비트 = 255.255.255.224

==== 클래스 비사용 주소지정

* 옥텟 단위가 아닌 임의의 지점
* 구분점은 네트워크 ID 에 쓰이는 비트의 수
** ex. 227.82.157.177 이 처음 27비트를 네트워크 ID 로 사용하는 네트워크에 속하는 IP 라면?
*** 227.82.157.160 으로 표현

==== 서브넷 마스크와 기본 게이트웨이

* / 표기는 IP 주소의 부속물
* 그 외에 기본 게이트웨이 식별자도 많이 쓰임 - 특정 장비에 대한 기본 라우팅 기능을 제공하는 라우터 IP 주소
** 원격 장비에 데이터그램을 보내고 싶을 때 기본 게이트웨이에 전송

=== IP 주소의 수와 멀티호밍

호스트가 하나 이상의 IP 주소를 갖는 것, 2가지 방법이 가능

* 2개 이상의 인터페이스를 동일한 네트워크에 연결
* 2개 이상의 서로 다른 네트워크에 인터페이스를 연결

=== IP 주소 관리와 할당 방법과 기관

* 중앙 기관에서 주소를 기관이 필요로 하는 장비 수 만큼 블록 단위로 할당
* IANA (ICANN) -> 대륙별 할당 (RIR) -> 국가 (NIR), 로컬 (LIR)

== 17장. 클래스 단위 (전통적) 주소 지정

=== IP 주소 클래스

* 기관별 규모를 3가지로 분류, 총 5개의 클래스
** A ~ E
** A, B, C 가 7/8 을 차지. 유니캐스트 IP 주소지정
* 장점
** 단순성과 명확성
** 타당한 유연성: 당시 예상 발전 속도에 맞는 요구 충족
** 라우팅 용이성
** 예약 주소

=== IP 클래스 단위 주소지정의 네트워크/호스트 식별과 주소 용역

* 클래스에 관한 정보가 IP 주소에 직접 인코딩 되어 있음
** 주소 몇 비트만 보고 그 주소가 어떤 클래스에 속해 있는지 파악할 수 있음

==== 클래스 결정 알고리즘

* IP 주소의 처음 몇 비트만을 보고 라우터가 네트워크/호스트 ID 파악, 데이터그램을 어떻게 처리할 지 쉽게 파악할 수 있음
** 4개의 비트만 보고 판단 가능
** p260 표

=== 특수 의미를 갖는 IP 주소

* 일부 IP 주소는 하나 이상의 장비를 간접적으로 가리키는데 쓰인다
** 모두 0 or 모두 1
* 네트워크 ID / 호스트 ID 에서
** - / 모두 0: 전체 네트워크
** 모두 0 / -: 이 네트워크에서 지정된 호스트 (현재 or 기본 네트워크의 호스트)
** 모두 0 / 모두 0: 자신의 IP 주소를 모르는 장비가 자신을 가리킴
** - / 모두 1: 지정된 네트워크의 모든 호스트
** 모두 1 / 모두 1: 전역 브로드캐스트

=== IP 예약, 사설, 루프백 주소

* 일반 주소 할당에 쓰일 수 없는 IP 주소들
* p267 표에 정리
** 각 클래스별로 사설 주소 블록이 있다 (10, 127, 192.168)

==== 예약 주소

* 향후 테스트나 인터넷을 관리하기 위한 내부 용도 예약
** 주요 클래스 (A, B, C) 각각의 첫/끝 부분에 나타난다

==== 사설, 비등록, 라우팅 불가 주소

* 비등록 (unregistered) 주소: 사설 주소에만 사용할 수 있는, 라우팅이 불가능한 특수 주소 집합을 정의
* 사설 주소를 사용하는 네트워크를 Public 인터넷에 연결하려면 추가 장비, NAT 등을 도입해야 한다

==== 루프백 주소

* 127.0.0.0 ~ 127.255.255.255
* 여기로 보낸 IP 데이터그램은 데이터 링크 계층으로 가지 않고 IP 계층으로 되돌아온다
* 3계층 IP 구현은 자신이 전송한 데이터를 즉시 받는다
* TCP/IP 프로토콜 구현을 테스트하는 데 쓰인다

=== 클래스 단위 IP 주소지정의 문제점

* 내부 주소 유연성 부족: 대형 기관은 커다란 단일 블록 할당 -> 네트워크 구조를 적절히 반영할 수 없음
** 주소의 내부 계층 구조를 만들 방법이 없음
* 주소공간의 비효율적 사용: A, B, C 만 존재 -> 낭비
** 세밀성이 대형 인터네트워크에서 사용하기에는 너무 낮다 = 네트워크 크기를 선택할 수 있는 옵션이 매우 적다
* 라우터 테이블 항목이 너무 커짐: 라우터에 항목이 많이 추가되어 성능 문제
* 위 문제들은 서브네팅, 클래스 비사용 주소지정, 라우팅으로 해결